<!doctype html><html><head><meta charset="utf-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js">
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
<link rel="stylesheet" href="https://gitcdn.xyz/repo/goessner/mdmath/master/css/texmath.css">
<link rel="stylesheet" href="https://gitcdn.xyz/repo/goessner/mdmath/master/css/vscode-texmath.css">

</head><body>
<h1 id="ovirt-virtual-machine-infrastructure" data-line="0" class="code-line">oVirt Virtual Machine Infrastructure</h1>
<p data-line="3" class="code-line">The <code>ovirt.vm-infra</code> role manages the virtual machine infrastructure in oVirt.
This role also creates inventory of created virtual machines it defines if
<code>wait_for_ip</code> is set to <code>true</code> and state of virtual machine is <code>running</code>.
All defined virtual machine are part of <code>ovirt_vm</code> inventory group.
Role also create <code>ovirt_tag_{tag_name}</code> groups if there are any
tags assigned to the virtual machine and place all virtual machine with that tag
to that inventory group.</p>
<p data-line="11" class="code-line">For example for following variable structure:</p>
<pre><code data-line="13" class="code-line language-yaml"><div><span class="hljs-attr">vms:</span>
<span class="hljs-attr">  - name:</span> <span class="hljs-string">myvm1</span>
<span class="hljs-attr">    tag:</span> <span class="hljs-string">mytag1</span>
<span class="hljs-attr">    profile:</span> <span class="hljs-string">myprofile</span>

<span class="hljs-attr">  - name:</span> <span class="hljs-string">myvm2</span>
<span class="hljs-attr">    tag:</span> <span class="hljs-string">mytag2</span>
<span class="hljs-attr">    profile:</span> <span class="hljs-string">myprofile</span>
</div></code></pre>
<p data-line="24" class="code-line">The role will create inventory groups <code>ovirt_vm</code> where will be both virtual
machines <code>myvm1</code> and <code>myvm2</code>. The role also create inventory groups <code>ovirt_tag_mytag1</code>
with virtual machine <code>myvm1</code> and inventory group <code>ovirt_tag_mytag2</code> with virtual
machine <code>myvm2</code>.</p>
<h2 id="note" data-line="29" class="code-line">Note</h2>
<p data-line="31" class="code-line">Please note that when installing this role from Ansible Galaxy you are instructed to run following command:</p>
<pre><code data-line="33" class="code-line language-bash"><div>$ ansible-galaxy install ovirt.vm-infra
</div></code></pre>
<p data-line="37" class="code-line">This will download the role to the directory with the same name as you specified on the
command line, in this case <code>ovirt.vm-infra</code>. But note that it is case sensitive, so if you specify
for example <code>OVIRT.vm-infra</code> it will download the same role, but it will add it to the directory named
<code>OVIRT.vm-infra</code>, so you later always have to use this role with upper case prefix. So be careful how
you specify the name of the role on command line.</p>
<p data-line="43" class="code-line">For the RPM installation we install three legacy names <code>ovirt.vm-infra</code>, <code>oVirt.vm-infra</code> and <code>ovirt-vm-infra</code>.
So you can use any of this name. This documentation and examples in this repository are using name <code>ovirt.vm-infra</code>.
<code>oVirt.vm-infra</code> and <code>ovirt-vm-infra</code> role names are deprecated.</p>
<h2 id="requirements" data-line="47" class="code-line">Requirements</h2>
<ul>
<li data-line="50" class="code-line">Ansible version 2.9 or higher</li>
<li data-line="51" class="code-line">Python SDK version 4.3 or higher</li>
</ul>
<h2 id="limitations" data-line="53" class="code-line">Limitations</h2>
<ul>
<li data-line="56" class="code-line">Does not support Ansible Check Mode (Dry Run).</li>
</ul>
<h2 id="role-variables" data-line="58" class="code-line">Role Variables</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>vms</td>
<td>UNDEF</td>
<td>List of dictionaries with virtual machine specifications.</td>
</tr>
<tr>
<td>affinity_groups</td>
<td>UNDEF</td>
<td>List of dictionaries with affinity groups specifications.</td>
</tr>
<tr>
<td>wait_for_ip</td>
<td>false</td>
<td>If true, the playbook should wait for the virtual machine IP reported by the guest agent.</td>
</tr>
<tr>
<td>wait_for_ip_version</td>
<td>v4</td>
<td>Specify which IP version should be wait for. Either v4 or v6.</td>
</tr>
<tr>
<td>wait_for_ip_range</td>
<td>0.0.0.0/0</td>
<td>Specify CIDR of virutal machine IP which should be reported. Works only for IPv4.</td>
</tr>
<tr>
<td>debug_vm_create</td>
<td>false</td>
<td>If true, logs the tasks of the virtual machine being created. The log can contain passwords.</td>
</tr>
<tr>
<td>vm_infra_create_single_timeout</td>
<td>180</td>
<td>Time in seconds to wait for VM to be created and started (if state is running).</td>
</tr>
<tr>
<td>vm_infra_create_poll_interval</td>
<td>15</td>
<td>Polling interval. Time in seconds to wait between check of state of VM.</td>
</tr>
<tr>
<td>vm_infra_create_all_timeout</td>
<td>vm_infra_create_single_timeout * (vms.length)</td>
<td>Total time to wait for all VMs to be created/started.</td>
</tr>
<tr>
<td>vm_infra_wait_for_ip_retries</td>
<td>5</td>
<td>Number of retries to check if VM is reporting it's IP address.</td>
</tr>
<tr>
<td>vm_infra_wait_for_ip_delay</td>
<td>5</td>
<td>Polling interval of IP address. Time in seconds to wait between check if VM reports IP address.</td>
</tr>
</tbody>
</table>
<p data-line="76" class="code-line">The <code>vms</code> and <code>profile</code> variables can contain following attributes, note that if you define same variable in both the value in <code>vms</code> has precendence:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>UNDEF</td>
<td>Name of the virtual machine to create.</td>
</tr>
<tr>
<td>tag</td>
<td>UNDEF</td>
<td>Name of the tag to assign to the virtual machine. Only administrator users can use this attribute.</td>
</tr>
<tr>
<td>cloud_init</td>
<td>UNDEF</td>
<td>Dictionary with values for Unix-like Virtual Machine initialization using cloud init. See below <i>cloud_init</i> section for more detailed description.</td>
</tr>
<tr>
<td>cloud_init_nics</td>
<td>UNDEF</td>
<td>List of dictionaries representing network interafaces to be setup by cloud init. See below <i>cloud_init_nics</i> section for more detailed description.</td>
</tr>
<tr>
<td>sysprep</td>
<td>UNDEF</td>
<td>Dictionary with values for Windows Virtual Machine initialization using sysprep. See below <i>sysprep</i> section for more detailed description.</td>
</tr>
<tr>
<td>profile</td>
<td>UNDEF</td>
<td>Dictionary specifying the virtual machine hardware. See the table below.</td>
</tr>
<tr>
<td>state</td>
<td>present</td>
<td>Should the Virtual Machine be stopped, present or running. Takes precedence before state value in profile.</td>
</tr>
<tr>
<td>nics</td>
<td>UNDEF</td>
<td>List of dictionaries specifying the NICs of the virtual machine. See below for more detailed description.</td>
</tr>
<tr>
<td>cluster</td>
<td>UNDEF</td>
<td>Name of the cluster where the virtual machine will be created.</td>
</tr>
<tr>
<td>clone</td>
<td>No</td>
<td>If yes then the disks of the created virtual machine will be cloned and independent of the template.  This parameter is used only when state is running or present and VM didn't exist before.</td>
</tr>
<tr>
<td>template</td>
<td>Blank</td>
<td>Name of template that the virtual machine should be based on.</td>
</tr>
<tr>
<td>template_version</td>
<td>UNDEF</td>
<td>Version number of the template to be used for VM. By default the latest available version of the template is used.</td>
</tr>
<tr>
<td>memory</td>
<td>UNDEF</td>
<td>Amount of virtual machine memory.</td>
</tr>
<tr>
<td>memory_max</td>
<td>UNDEF</td>
<td>Upper bound of virtual machine memory up to which memory hot-plug can be performed.</td>
</tr>
<tr>
<td>memory_guaranteed</td>
<td>UNDEF</td>
<td>Amount of minimal guaranteed memory of the Virtual Machine. Prefix uses IEC 60027-2 standard (for example 1GiB, 1024MiB). <i>memory_guaranteed</i> parameter can't be lower than <i>memory</i> parameter.</td>
</tr>
<tr>
<td>cores</td>
<td>UNDEF</td>
<td>Number of CPU cores used by the the virtual machine.</td>
</tr>
<tr>
<td>sockets</td>
<td>UNDEF</td>
<td>Number of virtual CPUs sockets of the Virtual Machine.</td>
</tr>
<tr>
<td>cpu_shares</td>
<td>UNDEF</td>
<td>Set a CPU shares for this Virtual Machine.</td>
</tr>
<tr>
<td>cpu_threads</td>
<td>UNDEF</td>
<td>Set a CPU threads for this Virtual Machine.</td>
</tr>
<tr>
<td>disks</td>
<td>UNDEF</td>
<td>List of dictionaries specifying the additional virtual machine disks. See below for more detailed description.</td>
</tr>
<tr>
<td>nics</td>
<td>UNDEF</td>
<td>List of dictionaries specifying the NICs of the virtual machine. See below for more detailed description.</td>
</tr>
<tr>
<td>custom_properties</td>
<td>UNDEF</td>
<td>Properties sent to VDSM to configure various hooks.<br/> Custom properties is a list of dictionary which can have following values: <br/><i>name</i> - Name of the custom property. For example: hugepages, vhost, sap_agent, etc.<br/><i>regexp</i> - Regular expression to set for custom property.<br/><i>value</i> - Value to set for custom property.</td>
</tr>
<tr>
<td>high_availability</td>
<td>UNDEF</td>
<td>Whether or not the node should be set highly available.</td>
</tr>
<tr>
<td>high_availability_priority</td>
<td>UNDEF</td>
<td>Indicates the priority of the virtual machine inside the run and migration queues. Virtual machines with higher priorities will be started and migrated before virtual machines with lower priorities. The value is an integer between 0 and 100. The higher the value, the higher the priority. If no value is passed, default value is set by oVirt/RHV engine.</td>
</tr>
<tr>
<td>io_threads</td>
<td>UNDEF</td>
<td>Number of IO threads used by virtual machine. 0 means IO threading disabled.</td>
</tr>
<tr>
<td>description</td>
<td>UNDEF</td>
<td>Description of the Virtual Machine.</td>
</tr>
<tr>
<td>operating_system</td>
<td>UNDEF</td>
<td>Operating system of the Virtual Machine. For example: rhel_7x64</td>
</tr>
<tr>
<td>type</td>
<td>UNDEF</td>
<td>Type of the Virtual Machine. Possible values: desktop, server or high_performance</td>
</tr>
<tr>
<td>graphical_console</td>
<td>UNDEF</td>
<td>Assign graphical console to the virtual machine.<br/>Graphical console is a dictionary which can have following values:<br/><i>headless_mode</i> - If true disable the graphics console for this virtual machine.<br/><i>protocol</i> - 'VNC', 'Spice' or both.</td>
</tr>
<tr>
<td>storage_domain</td>
<td>UNDEF</td>
<td>Name of the storage domain where all virtual machine disks should be created. Considered only when template is provided.</td>
</tr>
<tr>
<td>state</td>
<td>present</td>
<td>Should the Virtual Machine be stopped, present or running.</td>
</tr>
<tr>
<td>ssh_key</td>
<td>UNDEF</td>
<td>SSH key to be deployed to the virtual machine. This is parameter is keep for backward compatibility and has precendece before <i>authorized_ssh_keys</i> in <i>cloud_init</i> dictionary.</td>
</tr>
<tr>
<td>domain</td>
<td>UNDEF</td>
<td>The domain of the virtual machine. This is parameter is keep for backward compatibility and has precendece before <i>host_name</i> in <i>cloud_init</i> or <i>sysprep</i> dictionary.</td>
</tr>
<tr>
<td>lease</td>
<td>UNDEF</td>
<td>Name of the storage domain this virtual machine lease reside on.</td>
</tr>
<tr>
<td>root_password</td>
<td>UNDEF</td>
<td>The root password of the virtual machine. This is parameter is keep for backward compatibility and has precendece before <i>root_password</i> in <i>cloud_init</i> or <i>sysprep</i> dictionary.</td>
</tr>
<tr>
<td>cpu_mode</td>
<td>UNDEF</td>
<td>CPU mode of the virtual machine. It can be some of the following: host_passthrough, host_model or custom.</td>
</tr>
<tr>
<td>placement_policy</td>
<td>UNDEF</td>
<td>The configuration of the virtual machine's placement policy.</td>
</tr>
<tr>
<td>boot_devices</td>
<td>UNDEF</td>
<td>List of boot devices which should be used to boot. Valid entries are <code>cdrom</code>, <code>hd</code>, <code>network</code>.</td>
</tr>
<tr>
<td>serial_console</td>
<td>UNDEF</td>
<td>True enable VirtIO serial console, False to disable it. By default is chosen by oVirt/RHV engine.</td>
</tr>
<tr>
<td>serial_policy</td>
<td>UNDEF</td>
<td>Specify a serial number policy for the Virtual Machine. Following options are supported. <br/><i>vm</i> - Sets the Virtual Machine's UUID as its serial number. <br/><i>host</i> - Sets the host's UUID as the Virtual Machine's serial number. <br/><i>custom</i> - Allows you to specify a custom serial number in serial_policy_value.</td>
</tr>
<tr>
<td>serial_policy_value</td>
<td>UNDEF</td>
<td>Allows you to specify a custom serial number. This parameter is used only when <i>serial_policy</i> is custom.</td>
</tr>
</tbody>
</table>
<p data-line="122" class="code-line">The item in <code>disks</code> list of <code>profile</code> dictionary can contain following attributes:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>UNDEF</td>
<td>The size of the additional disk.</td>
</tr>
<tr>
<td>name</td>
<td>UNDEF</td>
<td>The name of the additional disk.</td>
</tr>
<tr>
<td>id</td>
<td>UNDEF</td>
<td>Id of the disk. If you pass id of the disk and name the disk will be looked up by id and will update name of the disk if it differs from the name passed in name parameter.</td>
</tr>
<tr>
<td>storage_domain</td>
<td>UNDEF</td>
<td>The name of storage domain where disk should be created.</td>
</tr>
<tr>
<td>interface</td>
<td>UNDEF</td>
<td>The interface of the disk.</td>
</tr>
<tr>
<td>name_prefix</td>
<td>True</td>
<td>If true the name of the vm will be used as prefix of disk name. If false only the name of disk will be used as disk name - could be useful when creating vm from template with custom disk size.</td>
</tr>
<tr>
<td>format</td>
<td>UNDEF</td>
<td>Specify format of the disk.  <ul><li>cow - If set, the disk will by created as sparse disk, so space will be allocated for the volume as needed. This format is also known as thin provisioned disks</li><li>raw - If set, disk space will be allocated right away. This format is also known as preallocated disks.</li></ul></td>
</tr>
<tr>
<td>bootable</td>
<td>UNDEF</td>
<td>True if the disk should be bootable.</td>
</tr>
<tr>
<td>activate</td>
<td>UNDEF</td>
<td>True if the disk should be activated</td>
</tr>
</tbody>
</table>
<p data-line="136" class="code-line">The item in <code>nics</code> list of <code>profile</code> dictionary can contain following attributes:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>UNDEF</td>
<td>The name of the network interface.</td>
</tr>
<tr>
<td>interface</td>
<td>UNDEF</td>
<td>Type of the network interface.</td>
</tr>
<tr>
<td>mac_address</td>
<td>UNDEF</td>
<td>Custom MAC address of the network interface, by default it's obtained from MAC pool.</td>
</tr>
<tr>
<td>network</td>
<td>UNDEF</td>
<td>Logical network which the VM network interface should use. If network is not specified, then Empty network is used.</td>
</tr>
<tr>
<td>profile</td>
<td>UNDEF</td>
<td>Virtual network interface profile to be attached to VM network interface.</td>
</tr>
</tbody>
</table>
<p data-line="146" class="code-line">The <code>affinity_groups</code> list can contain following attributes:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>cluster</td>
<td>UNDEF (Required)</td>
<td>Name of the cluster of the affinity group.</td>
</tr>
<tr>
<td>description</td>
<td>UNDEF</td>
<td>Human readable description.</td>
</tr>
<tr>
<td>host_enforcing</td>
<td>false</td>
<td><ul><li>true - VM cannot start on host if it does not satisfy the <code>host_rule</code>.</li><li>false - VM will follow <code>host_rule</code> with soft enforcement.</li></ul></td>
</tr>
<tr>
<td>host_rule</td>
<td>UNDEF</td>
<td><ul><li>positive - VM's in this group must run on this host.</li> <li>negative - VM's in this group may not run on this host</li></ul></td>
</tr>
<tr>
<td>hosts</td>
<td>UNDEF</td>
<td>List of host names assigned to this group.</td>
</tr>
<tr>
<td>name</td>
<td>UNDEF (Required)</td>
<td>Name of affinity group.</td>
</tr>
<tr>
<td>state</td>
<td>UNDEF</td>
<td>Whether group should be present or absent.</td>
</tr>
<tr>
<td>vm_enforcing</td>
<td>false</td>
<td><ul><li>true - VM cannot start if it cannot satisfy the <code>vm_rule</code>.</li><li>false - VM will follow <code>vm_rule</code> with soft enforcement.</li></ul></td>
</tr>
<tr>
<td>vm_rule</td>
<td>UNDEF</td>
<td><ul><li>positive - all vms in this group try to run on the same host.</li><li>negative - all vms in this group try to run on separate hosts.</li><li>disabled - this affinity group does not take effect.</li></ul></td>
</tr>
<tr>
<td>vms</td>
<td>UNDEF</td>
<td>List of VM's to be assigned to this affinity group.</td>
</tr>
<tr>
<td>wait</td>
<td>true</td>
<td>If true, the module will wait for the desired state.</td>
</tr>
</tbody>
</table>
<p data-line="162" class="code-line">The <code>affinity_labels</code> list can contain following attributes:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>cluster</td>
<td>UNDEF (Required)</td>
<td>Name of the cluster of the affinity label group.</td>
</tr>
<tr>
<td>hosts</td>
<td>UNDEF</td>
<td>List of host names assigned to this label.</td>
</tr>
<tr>
<td>name</td>
<td>UNDEF (Required)</td>
<td>Name of affinity label.</td>
</tr>
<tr>
<td>state</td>
<td>UNDEF</td>
<td>Whether label should be present or absent.</td>
</tr>
<tr>
<td>vms</td>
<td>UNDEF</td>
<td>List of VM's to be assigned to this affinity label.</td>
</tr>
</tbody>
</table>
<p data-line="172" class="code-line">The <code>cloud_init</code> dictionary can contain following attributes:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>host_name</td>
<td>Hostname to be set to Virtual Machine when deployed.</td>
</tr>
<tr>
<td>timezone</td>
<td>Timezone to be set to Virtual Machine when deployed.</td>
</tr>
<tr>
<td>user_name</td>
<td>Username to be used to set password to Virtual Machine when deployed.</td>
</tr>
<tr>
<td>root_password</td>
<td>Password to be set for user specified by user_name parameter. By default it's set for root user.</td>
</tr>
<tr>
<td>authorized_ssh_keys</td>
<td>Use this SSH keys to login to Virtual Machine.</td>
</tr>
<tr>
<td>regenerate_ssh_keys</td>
<td>If True SSH keys will be regenerated on Virtual Machine.</td>
</tr>
<tr>
<td>custom_script</td>
<td>Cloud-init script which will be executed on Virtual Machine when deployed. This is appended to the end of the cloud-init script generated by any other options.</td>
</tr>
<tr>
<td>dns_servers</td>
<td>DNS servers to be configured on Virtual Machine.</td>
</tr>
<tr>
<td>dns_search</td>
<td>DNS search domains to be configured on Virtual Machine.</td>
</tr>
<tr>
<td>nic_boot_protocol</td>
<td>Set boot protocol of the network interface of Virtual Machine. Can be one of none, dhcp or static.</td>
</tr>
<tr>
<td>nic_ip_address</td>
<td>If boot protocol is static, set this IP address to network interface of Virtual Machine.</td>
</tr>
<tr>
<td>nic_netmask</td>
<td>If boot protocol is static, set this netmask to network interface of Virtual Machine.</td>
</tr>
<tr>
<td>nic_gateway</td>
<td>If boot protocol is static, set this gateway to network interface of Virtual Machine.</td>
</tr>
<tr>
<td>nic_name</td>
<td>Set name to network interface of Virtual Machine.</td>
</tr>
<tr>
<td>nic_on_boot</td>
<td>If True network interface will be set to start on boot.</td>
</tr>
</tbody>
</table>
<p data-line="192" class="code-line">The <code>sysprep</code> dictionary can contain following attributes:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>host_name</td>
<td>Hostname to be set to Virtual Machine when deployed.</td>
</tr>
<tr>
<td>active_directory_ou</td>
<td>Active Directory Organizational Unit, to be used for login of user.</td>
</tr>
<tr>
<td>org_name</td>
<td>Organization name to be set to Windows Virtual Machine.</td>
</tr>
<tr>
<td>user_name</td>
<td>Username to be used for set password to Windows Virtual Machine.</td>
</tr>
<tr>
<td>root_password</td>
<td>Password to be set for user specified by user_name parameter. By default it's set for root user.</td>
</tr>
<tr>
<td>windows_license_key</td>
<td>License key to be set to Windows Virtual Machine.</td>
</tr>
<tr>
<td>input_locale</td>
<td>Input localization of the Windows Virtual Machine.</td>
</tr>
<tr>
<td>system_locale</td>
<td>System localization of the Windows Virtual Machine.</td>
</tr>
<tr>
<td>ui_language</td>
<td>UI language of the Windows Virtual Machine.</td>
</tr>
<tr>
<td>domain</td>
<td>Domain to be set to Windows Virtual Machine.</td>
</tr>
<tr>
<td>timezone</td>
<td>Timezone to be set to Windows Virtual Machine.</td>
</tr>
</tbody>
</table>
<p data-line="208" class="code-line">The <code>cloud_init_nics</code> List of dictionaries representing network interafaces to be setup by cloud init. This option is used, when user needs to setup more network interfaces via cloud init.
If one network interface is enough, user should use cloud_init nic_* parameters. cloud_init nic_* parameters are merged with cloud_init_nics parameters. Dictionary can contain following values.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>nic_boot_protocol</td>
<td>Set boot protocol of the network interface of Virtual Machine. Can be one of none, dhcp or static.</td>
</tr>
<tr>
<td>nic_ip_address</td>
<td>If boot protocol is static, set this IP address to network interface of Virtual Machine.</td>
</tr>
<tr>
<td>nic_netmask</td>
<td>If boot protocol is static, set this netmask to network interface of Virtual Machine.</td>
</tr>
<tr>
<td>nic_gateway</td>
<td>If boot protocol is static, set this gateway to network interface of Virtual Machine.</td>
</tr>
<tr>
<td>nic_name</td>
<td>Set name to network interface of Virtual Machine.</td>
</tr>
<tr>
<td>nic_on_boot</td>
<td>If True network interface will be set to start on boot.</td>
</tr>
</tbody>
</table>
<h2 id="dependencies" data-line="220" class="code-line">Dependencies</h2>
<p data-line="223" class="code-line">None.</p>
<h2 id="example-playbook" data-line="225" class="code-line">Example Playbook</h2>
<pre><code data-line="228" class="code-line language-yaml"><div><span class="hljs-meta">---</span>
<span class="hljs-attr">- name:</span> <span class="hljs-string">oVirt</span> <span class="hljs-string">infra</span>
<span class="hljs-attr">  hosts:</span> <span class="hljs-string">localhost</span>
<span class="hljs-attr">  connection:</span> <span class="hljs-string">local</span>
<span class="hljs-attr">  gather_facts:</span> <span class="hljs-literal">false</span>

<span class="hljs-attr">  vars_files:</span>
    <span class="hljs-comment"># Contains encrypted `engine_password` varibale using ansible-vault</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">passwords.yml</span>

<span class="hljs-attr">  vars:</span>
<span class="hljs-attr">    engine_fqdn:</span> <span class="hljs-string">ovirt-engine.example.com</span>
<span class="hljs-attr">    engine_user:</span> <span class="hljs-string">admin@internal</span>
<span class="hljs-attr">    engine_cafile:</span> <span class="hljs-string">/etc/pki/ovirt-engine/ca.pem</span>

<span class="hljs-attr">    httpd_vm:</span>
<span class="hljs-attr">      cluster:</span> <span class="hljs-string">production</span>
<span class="hljs-attr">      domain:</span> <span class="hljs-string">example.com</span>
<span class="hljs-attr">      template:</span> <span class="hljs-string">rhel7</span>
<span class="hljs-attr">      memory:</span> <span class="hljs-number">2</span><span class="hljs-string">GiB</span>
<span class="hljs-attr">      cores:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">      ssh_key:</span> <span class="hljs-string">ssh-rsa</span> <span class="hljs-string">AAA...LGx</span> <span class="hljs-string">user@fqdn</span>
<span class="hljs-attr">      disks:</span>
<span class="hljs-attr">        - size:</span> <span class="hljs-number">10</span><span class="hljs-string">GiB</span>
<span class="hljs-attr">          name:</span> <span class="hljs-string">data</span>
<span class="hljs-attr">          storage_domain:</span> <span class="hljs-string">mynfsstorage</span>
<span class="hljs-attr">          interface:</span> <span class="hljs-string">virtio</span>

<span class="hljs-attr">    db_vm:</span>
<span class="hljs-attr">      cluster:</span> <span class="hljs-string">production</span>
<span class="hljs-attr">      domain:</span> <span class="hljs-string">example.com</span>
<span class="hljs-attr">      template:</span> <span class="hljs-string">rhel7</span>
<span class="hljs-attr">      memory:</span> <span class="hljs-number">4</span><span class="hljs-string">GiB</span>
<span class="hljs-attr">      cores:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">      ssh_key:</span> <span class="hljs-string">ssh-rsa</span> <span class="hljs-string">AAA...LGx</span> <span class="hljs-string">user@fqdn</span>
<span class="hljs-attr">      disks:</span>
<span class="hljs-attr">        - size:</span> <span class="hljs-number">50</span><span class="hljs-string">GiB</span>
<span class="hljs-attr">          name:</span> <span class="hljs-string">data</span>
<span class="hljs-attr">          storage_domain:</span> <span class="hljs-string">mynfsstorage</span>
<span class="hljs-attr">          interface:</span> <span class="hljs-string">virtio</span>
<span class="hljs-attr">      nics:</span>
<span class="hljs-attr">        - name:</span> <span class="hljs-string">ovirtmgmt</span>
<span class="hljs-attr">          network:</span> <span class="hljs-string">ovirtmgmt</span>
<span class="hljs-attr">          profile:</span> <span class="hljs-string">ovirtmgmt</span>

<span class="hljs-attr">    vms:</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">postgresql-vm-0</span>
<span class="hljs-attr">        tag:</span> <span class="hljs-string">postgresql_vm</span>
<span class="hljs-attr">        profile:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ db_vm }}</span>"</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">postgresql-vm-1</span>
<span class="hljs-attr">        tag:</span> <span class="hljs-string">postgresql_vm</span>
<span class="hljs-attr">        profile:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ db_vm }}</span>"</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">apache-vm</span>
<span class="hljs-attr">        tag:</span> <span class="hljs-string">httpd_vm</span>
<span class="hljs-attr">        profile:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ httpd_vm }}</span>"</span>

<span class="hljs-attr">    affinity_groups:</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">db-ag</span>
<span class="hljs-attr">        cluster:</span> <span class="hljs-string">production</span>
<span class="hljs-attr">        vm_enforcing:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">        vm_rule:</span> <span class="hljs-string">negative</span>
<span class="hljs-attr">        vms:</span>
<span class="hljs-bullet">          -</span> <span class="hljs-string">postgresql-vm-0</span>
<span class="hljs-bullet">          -</span> <span class="hljs-string">postgresql-vm-1</span>

<span class="hljs-attr">  roles:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">ovirt.vm-infra</span>
</div></code></pre>
<p data-line="298" class="code-line">The example below shows how to use inventory created by <code>ovirt.vm-infra</code> role in follow up play.</p>
<pre><code data-line="300" class="code-line language-yaml"><div><span class="hljs-meta">---</span>
<span class="hljs-attr">- name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">apache</span> <span class="hljs-string">VM</span>
<span class="hljs-attr">  hosts:</span> <span class="hljs-string">localhost</span>
<span class="hljs-attr">  connection:</span> <span class="hljs-string">local</span>
<span class="hljs-attr">  gather_facts:</span> <span class="hljs-literal">false</span>

<span class="hljs-attr">  vars_files:</span>
    <span class="hljs-comment"># Contains encrypted `engine_password` varibale using ansible-vault</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">passwords.yml</span>

<span class="hljs-attr">  vars:</span>
<span class="hljs-attr">    wait_for_ip:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">    httpd_vm:</span>
<span class="hljs-attr">      cluster:</span> <span class="hljs-string">production</span>
<span class="hljs-attr">      state:</span> <span class="hljs-string">running</span>
<span class="hljs-attr">      domain:</span> <span class="hljs-string">example.com</span>
<span class="hljs-attr">      template:</span> <span class="hljs-string">rhel7</span>
<span class="hljs-attr">      memory:</span> <span class="hljs-number">2</span><span class="hljs-string">GiB</span>
<span class="hljs-attr">      cores:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">      ssh_key:</span> <span class="hljs-string">ssh-rsa</span> <span class="hljs-string">AAA...LGx</span> <span class="hljs-string">user@fqdn</span>
<span class="hljs-attr">      disks:</span>
<span class="hljs-attr">        - size:</span> <span class="hljs-number">10</span><span class="hljs-string">GiB</span>
<span class="hljs-attr">          name:</span> <span class="hljs-string">data</span>
<span class="hljs-attr">          storage_domain:</span> <span class="hljs-string">mynfsstorage</span>
<span class="hljs-attr">          interface:</span> <span class="hljs-string">virtio</span>

<span class="hljs-attr">    vms:</span>
<span class="hljs-attr">      - name:</span> <span class="hljs-string">apache-vm</span>
<span class="hljs-attr">        tag:</span> <span class="hljs-string">apache</span>
<span class="hljs-attr">        profile:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ httpd_vm }}</span>"</span>

<span class="hljs-attr">  roles:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">ovirt.vm-infra</span>

<span class="hljs-attr">- name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">apache</span> <span class="hljs-string">on</span> <span class="hljs-string">VM</span>
<span class="hljs-attr">  hosts:</span> <span class="hljs-string">ovirt_tag_apache</span>

<span class="hljs-attr">  vars_files:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">apache_vars.yml</span>

<span class="hljs-attr">  roles:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">geerlingguy.apache</span>
</div></code></pre>
<p data-line="346" class="code-line"><a href="https://asciinema.org/a/111662"><img src="https://asciinema.org/a/111662.png" alt="asciicast" class="loading" id="image-hash-7e74a8ebfbd7175ecf2740a24c2e0c707c05a0a9611a4679f8cbaa0a93e661ec"></a></p>
<h2 id="license" data-line="348" class="code-line">License</h2>
<p data-line="351" class="code-line">Apache License 2.0</p>

</body></html>